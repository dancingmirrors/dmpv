name: mpv

on:
  push:
    branches:
      - master

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: actions/checkout@v4
        uses: actions/checkout@v4

      - name: dependencies
        run: |
          sudo sed -i 's/^Types: deb$/Types: deb deb-src/' /etc/apt/sources.list.d/ubuntu.sources
          sudo apt-get update
          sudo apt-get install -y build-essential git meson nasm ninja-build yasm
          sudo apt-get build-dep -y mpv

          git clone --depth 1 https://github.com/ffmpeg/ffmpeg.git ; cd ffmpeg
          ./configure --prefix=/usr/local --enable-shared ; make -j4 ; sudo make install

          git clone --depth 1 --recursive https://github.com/haasn/libplacebo.git ; cd libplacebo
          meson setup --prefix=/usr/local build ; meson compile -C build ; cd build && sudo ninja install

      - name: configure
        run: ./configure

      - name: make and make install
        run: |
          make
          sudo make install
          ldd /usr/local/bin/mpv
