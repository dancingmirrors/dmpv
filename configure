#!/usr/bin/env python3

import os
import platform
from TOOLS.configure_common import *

begin()

# (workaround for insufficient Python lambda syntax)
def chain(*a):
    return a[-1]

# ============================================================================
# Understanding check() name patterns:
# ============================================================================
# The first argument to check() determines its behavior:
#
#   check("name")
#     - Internal dependency identifier only
#     - No command-line options generated
#     - Used by other checks via deps/deps_any/deps_neg
#     - Result not emitted to config.h
#
#   check("-name")
#     - Optional feature controllable via command line
#     - Generates: --enable-name, --disable-name, --with-name=yes/no/auto
#     - Used for optional features that should be auto-detected
#     - Result not emitted to config.h
#
#   check("name*")
#     - Internal dependency identifier
#     - No command-line options generated
#     - Result emitted to config.h as HAVE_NAME (0 or 1)
#     - Used for platform-specific features that code needs to check
#
#   check("-name*")
#     - Optional feature controllable via command line
#     - Generates: --enable-name, --disable-name, --with-name=yes/no/auto
#     - Result emitted to config.h as HAVE_NAME (0 or 1)
#     - Used for optional features that need both CLI control and C code checks
#
# Additional parameters:
#   required="message"
#     - Makes the check mandatory (configure fails if check fails)
#     - Should NOT be combined with "-" prefix (contradictory)
#     - Use for dependencies that are truly required to build
#
#   default=False
#     - Disables the feature by default (can be enabled with --enable-name)
#     - Only makes sense with "-" prefix
#
# Examples of correct usage:
#   - Required dependency: check("name", required="...", fn=...)
#   - Optional feature: check("-name", fn=...)
#   - Optional with config.h: check("-name*", fn=...)
#   - Platform check: check("name*", fn=...)
# ============================================================================

check("-lgpl",
      desc      = "LGPL (version 2.1 or later) build",
      default   = False)
check("gpl*",
      desc      = "GPL (version 2 or later) build",
      deps_neg  = "lgpl")

check(desc      = "whether the compiler works",
      required  = "C compiler: missing or broken",
      fn        = lambda: check_program("CC") and check_cc(link = []))
check(desc      = "pkg-config",
      required  = "pkg-config: missing or not in PATH",
      fn        = lambda: check_program("PKG_CONFIG"))

system = platform.system()
if system == "Linux":
    add_cflags("-MD", "-MP", "-D_ISOC99_SOURCE", "-D_GNU_SOURCE",
               "-D_LARGEFILE_SOURCE", "-D_FILE_OFFSET_BITS=64",
               "-D_LARGEFILE64_SOURCE", "-Wall", "-fno-strict-aliasing")
elif system in ["FreeBSD", "OpenBSD", "NetBSD", "DragonFly"]:
    add_cflags("-MD", "-MP", "-D_ISOC99_SOURCE", "-D_BSD_SOURCE",
               "-D_LARGEFILE_SOURCE", "-D_FILE_OFFSET_BITS=64",
               "-D_LARGEFILE64_SOURCE", "-Wall", "-fno-strict-aliasing")
else:
    add_cflags("-MD", "-MP", "-D_ISOC99_SOURCE",
               "-D_LARGEFILE_SOURCE", "-D_FILE_OFFSET_BITS=64",
               "-D_LARGEFILE64_SOURCE", "-Wall", "-fno-strict-aliasing")
check(fn        = lambda: check_cc(flags = "-std=c11") or
                          check_cc(flags = "-std=c99"),
      required  = "C11 or C99 compiler: missing, broken, or too old")
check("-optimize",
      fn        = lambda: chain(add_cflags("-O3", "-pipe", "-fno-signed-zeros",
                                "-fno-trapping-math"), True),
      desc      = "optimization")
check("-debug-build",
      fn        = lambda: chain(add_cflags("-g3"), True),
      desc      = "-g3",
      default   = False)
check("-debug-build-extensive",
      fn        = lambda: chain(add_cflags("-O0", "-g", "-fno-omit-frame-pointer"), True),
      desc      = "-O0, -g, -fno-omit-frame-pointer",
      deps_neg  = "optimize",
      default   = False)
check(desc      = "warning CFLAGS",
      fn        = lambda: check_cc(flags = [
                        "-Werror=implicit-function-declaration",
                        "-Wno-error=deprecated-declarations",
                        "-Wno-error=unused-function",
                        "-Wempty-body",
                        "-Wdisabled-optimization",
                        "-Wstrict-prototypes",
                        "-Werror=format-security",
                        "-Wvla",
                        "-Wundef",
                        "-Wtype-limits",
                        "-Wmissing-field-initializers",
                        "-Wabsolute-value"]))

check("gnuc",
      desc      = "GNU C",
      fn        = lambda: check_cc(defined = "__GNUC__"))
check("clang",
      desc      = "clang",
      fn        = lambda: check_cc(defined = "__clang__"))

check("libdl*",
      fn        = lambda: check_cc(link = "-ldl", include = "dlfcn.h",
                                   expr = 'dlopen("", 0);'))
check("libm",
      fn        = lambda: check_cc(link = "-lm"))

check(desc      = "-fno-math-errno",
      fn        = lambda: check_cc(flags = "-fno-math-errno"))

check(desc      = "extra GCC warnings",
      deps      = "gnuc",
      deps_neg  = "clang",
      fn        = lambda: check_cc(flags = [
                        "-Wmissing-prototypes",
                        "-Wshadow",
                        "-Wparentheses",
                        "-Wpointer-arith",
                        "-Woverflow",
                        "-Wclobbered",
                        "-Wcast-function-type",
                        "-Wignored-qualifiers",
                        "-Wshift-overflow=2"]))
check(desc      = "extra clang warnings",
      deps      = "clang",
      fn        = lambda: check_cc(flags = [
                        "-fcolor-diagnostics",
                        "-Wunreachable-code-aggressive",
                        "-Wshift-overflow"]))

check("-fsanitize-undefined",
      desc      = "-fsanitize=undefined",
      default   = False,
      fn        = lambda: check_cc(flags = "-fsanitize=undefined", link = ["-fsanitize=undefined"]))
check("-fsanitize-address",
      desc      = "-fsanitize=address",
      default   = False,
      fn        = lambda: check_cc(flags = "-fsanitize=address", link = ["-fsanitize=address"]))
check("-fsanitize-thread",
      desc       = "-fsanitize=thread",
      default    = False,
      fn         = lambda: check_cc(flags = "-fsanitize=thread", link = ["-fsanitize=thread"]))

def check_git():
    if not check_program("GIT"):
        return False
    # I've seen cases where 'git' doesn't support 'git describe'.
    import subprocess
    try:
        result = subprocess.run([get_program("GIT"), "describe", "--help"],
                              stdout=subprocess.PIPE, stderr=subprocess.PIPE,
                              timeout=5)
        if result.returncode != 0:
            return False
        return True
    except (subprocess.TimeoutExpired, FileNotFoundError, OSError):
        return False

check("git*",
      required  = "git: missing, not in PATH, or doesn't support 'git describe'",
      fn        = check_git)

check("ninja*",
      required  = "ninja: missing or not in PATH",
      fn        = lambda: check_program("NINJA"))

check(desc      = "-fstack-protector-strong",
      fn        = lambda: check_cc(flags = "-fstack-protector-strong"))

check(fn        = lambda: check_cc(include = "unistd.h",
                                   defined = "_POSIX_VERSION"),
      required  = "POSIX system: required (must define _POSIX_VERSION)",
      sources   = ["osdep/language-posix.c",
                   "sub/filter_regex.c",
                   "osdep/path-unix.c"])

check(fn        = lambda: check_cc(link = "-pthread", flags = "-pthread",
                                   include = "pthread.h",
                                   expr = "pthread_self();"),
      required  = "pthreads: missing or broken")

check("stdatomic*",
      desc      = "stdatomic.h or slow emulation",
      fn        = lambda: check_cc(include = "stdatomic.h",
                                   expr =
                        "atomic_int_least64_t test = ATOMIC_VAR_INIT(123);"
                        "atomic_fetch_add(&test, 1);"))
check(deps_any  = ["stdatomic", "gnuc"],
      required  = "stdatomic.h or GCC: missing (need C11 atomics support)")

def check_iconv():
    has_libiconv_plug = check_cc(flags = "-DLIBICONV_PLUG")
    if check_cc(include = "iconv.h", link = [], expr = "iconv_open(0, 0);"):
        return True
    if check_cc(include = "iconv.h", link = "-liconv", expr = "iconv_open(0, 0);"):
        return True
    if has_libiconv_plug:
        if check_cc(flags = "-DLIBICONV_PLUG", include = "iconv.h", link = "-liconv",
                    expr = "iconv_open(0, 0);"):
            return True
    return False
check("-libiconv-plug*",
      desc      = "-DLIBICONV_PLUG",
      fn        = lambda: check_cc(flags = "-DLIBICONV_PLUG"))
check("iconv*",
      fn        = check_iconv)
check("-uchardet*",
      deps      = "iconv",
      fn        = lambda: check_pkg_config("uchardet"))

check(fn        = lambda: check_cc(include = "glob.h",
                                   expr = 'glob("filename", 0, 0, 0);'),
      required  = "glob.h: missing or broken")
check(fn        = lambda: check_cc(include = "sys/stat.h", expr = "fchmod(0, 0);"),
      required  = "fchmod: missing or broken")

check("glibc-thread-name*",
      fn        = lambda: check_cc(include = "pthread.h",
                    expr = 'pthread_setname_np(pthread_self(), "ducks");'))
check("bsd-thread-name*",
      fn        = lambda: check_cc(include = ["pthread.h", "pthread_np.h"],
                    expr = 'pthread_set_name_np(pthread_self(), "ducks");')
                  or check_cc(include = "pthread.h", expr = 'pthread_setname_np(pthread_self(), "ducks", NULL);'))

check("bsd-fstatfs*",
      desc      = "BSD fstatfs",
      fn        = lambda: check_cc(include = ["sys/param.h", "sys/mount.h"],
                    expr = "struct statfs fs; fstatfs(0, &fs); fs.f_fstypename;"))
check("linux-fstatfs*",
      desc      = "Linux fstatfs",
      fn        = lambda: check_cc(include = "sys/vfs.h",
                    expr = "struct statfs fs; fstatfs(0, &fs); fs.f_namelen;"))

check("-lua*",
      desc      = "Lua support",
      fn        = lambda: check_pkg_config("luajit >= 2.0.0") or
                          check_pkg_config("lua-5.1") or
                          check_pkg_config("lua51") or
                          check_pkg_config("lua-5.2") or
                          check_pkg_config("lua52") or
                          check_pkg_config("lua <= 5.2.999"),
      sources   = "player/lua.c")

check("libass*",
      desc      = "libass subtitle/OSD renderer",
      fn        = lambda: check_pkg_config("libass >= 0.17.0"),
      required  = "libass >= 0.17.0: missing, broken, or too old",
      sources   = ["sub/ass_mp.c",
                   "sub/osd_libass.c",
                   "sub/sd_ass.c"])

check(fn        = lambda: check_cc(link = "-lz", include = "zlib.h",
                                   expr = "inflate(0, Z_NO_FLUSH);"),
      required  = "zlib: missing or broken")

check("-lcms2*",
      desc      = "Little Color Management System 2",
      fn        = lambda: check_pkg_config("lcms2 >= 2.6"))

check("-libarchive*",
      fn        = lambda: check_pkg_config("libarchive >= 3.0.0"),
      sources   = ["demux/demux_libarchive.c",
                   "stream/stream_libarchive.c"])

check(desc      = "FFmpeg",
      fn        = lambda: check_pkg_config(
                    "libavutil      >= 58.12.100",
                    "libavcodec     >= 60.15.100",
                    "libavformat    >= 60.6.100",
                    "libswscale     >= 7.2.100",
                    "libavfilter    >= 9.12.100",
                    "libswresample  >= 4.10.100"),
      required  = "FFmpeg libraries: missing, broken, or too old (need libavutil >= 58.12.100, libavcodec >= 60.15.100, libavformat >= 60.6.100, libswscale >= 7.2.100, libavfilter >= 9.12.100, libswresample >= 4.10.100)")
check("-libavdevice*",
      fn        = lambda: check_pkg_config("libavdevice >= 60.3.100"))

check("-zimg*",
      fn        = lambda: check_pkg_config("zimg >= 3.0.5"),
      sources   = "video/zimg.c")

check("-pipewire*",
      desc      = "PipeWire audio output",
      fn        = lambda: check_pkg_config("libpipewire-0.3 >= 0.3.57") and check_binary_exists("pipewire"),
      sources   = "audio/out/ao_pipewire.c")
check("-pulseaudio*",
      desc      = "PulseAudio audio output",
      fn        = lambda: check_pkg_config("libpulse >= 16.0") and check_binary_exists("pulseaudio"),
      sources   = "audio/out/ao_pulse.c")
check("-alsa*",
      desc      = "ALSA audio output",
      fn        = lambda: check_pkg_config("alsa >= 1.0.18"),
      sources   = "audio/out/ao_alsa.c")
check("-oss*",
      desc      = "OSS audio output",
      deps      = "gpl",
      fn        = lambda: check_cc(include = "sys/soundcard.h",
                  expr = "SNDCTL_DSP_HALT;"),
      sources   = "audio/out/ao_oss.c")
check("-sndio*",
      desc      = "sndio audio output",
      fn        = lambda: check_pkg_config("sndio >= 1.0.0"),
      sources   = "audio/out/ao_sndio.c")

check("wsdisplay-usl-io-h*",
      fn        = lambda: check_cc(include = ["sys/types.h",
                  "dev/wscons/wsdisplay_usl_io.h"]))
check("vt_h*",
      fn        = lambda: check_cc(include = ["sys/vt.h", "sys/ioctl.h"],
                                   expr = "int m; ioctl(0, VT_GETMODE, &m);"))
check("consio_h*",
      deps_neg  = "vt_h",
      fn        = lambda: check_cc(include = ["sys/consio.h", "sys/ioctl.h"],
                                   expr = "int m; ioctl(0, VT_GETMODE, &m);"))
check("-drm*",
      desc      = "Direct Rendering Manager",
      deps_any  = ["wsdisplay-usl-io-h", "vt_h", "consio_h"],
      fn        = lambda: check_pkg_config("libdrm >= 2.4.105"),
      sources   = ["video/out/drm_atomic.c",
                   "video/out/drm_common.c",
                   "video/out/vo_drm.c"])
check("-drmprime*",
      fn        = lambda: check_cc(include = "libavutil/pixfmt.h",
                                   expr = "int i = AV_PIX_FMT_DRM_PRIME;"))
check(deps      = ["drm", "drmprime"],
      sources   = ["video/drmprime.c",
                   "video/out/drm_prime.c",
                   "video/out/hwdec/hwdec_drmprime.c",
                   "video/out/hwdec/hwdec_drmprime_overlay.c"])

check("gbm",
      desc      = "Generic Buffer Management",
      fn        = lambda: check_pkg_config("gbm"))

check("-libplacebo*",
      desc      = "libplacebo support",
      fn        = lambda: check_pkg_config("libplacebo >= 6.338.2"),
      sources   = ["video/out/placebo/ra_pl.c",
                   "video/out/placebo/utils.c",
                   "video/out/placebo/tone_map_helpers.c"])

def check_wayland_protos():
    data = get_pkg_config_variable("wayland-protocols", "pkgdatadir")
    if data is None:
        return False
    add_config_mak_var("WL_PROTO_DIR", data)
    return True

check("-wayland*",
      desc = "Wayland support",
      fn = lambda: (
          check_wayland_protos() and
          check_cc(include="linux/input-event-codes.h", link=[]) and
          check_program("WAYSCAN") and
          check_pkg_config(
              "wayland-client    >= 1.21.0",
              "wayland-cursor    >= 1.21.0",
              "wayland-protocols >= 1.41",
              "xkbcommon         >= 0.3.0"
          )
      ),
      sources = [
          "video/out/wayland_common.c",
          "generated/wayland/idle-inhibit-unstable-v1.c",
          "generated/wayland/presentation-time.c",
          "generated/wayland/xdg-shell.c",
          "generated/wayland/fractional-scale-v1.c",
          "generated/wayland/cursor-shape-v1.c",
          "generated/wayland/tablet-v2.c",
          "generated/wayland/xdg-decoration-unstable-v1.c",
          "generated/wayland/xdg-activation-v1.c",
          "generated/wayland/viewporter.c",
          "generated/wayland/linux-dmabuf-unstable-v1.c",
          "generated/wayland/fifo-v1.c",
          "generated/wayland/color-management-v1.c",
          "video/out/hwdec/dmabuf_interop_wl.c",
          "video/out/wldmabuf/context_wldmabuf.c",
          "video/out/wldmabuf/ra_wldmabuf.c"
      ],
)

check("-wayland-protocols-147*",
      desc      = "wayland-protocols >= 1.47",
      deps      = "wayland",
      fn        = lambda: check_pkg_config("wayland-protocols >= 1.47"))

check("memfd-create*",
      desc      = "memfd_create() for Wayland",
      deps      = "wayland",
      fn        = lambda: check_cc(include = "sys/mman.h", link = [],
                                   expr = "memfd_create(0, MFD_CLOEXEC | MFD_ALLOW_SEALING);"),
      sources   = "video/out/vo_wlshm.c")

check("-x11*",
      desc      = "X11 support",
      deps      = "gpl",
      fn        = lambda: check_pkg_config("x11         >= 1.0.0",
                                           "xscrnsaver  >= 1.0.0",
                                           "xext        >= 1.0.0",
                                           "xinerama    >= 1.0.0",
                                           "xpresent    >= 1.0.0",
                                           "xrandr      >= 1.2.0"),
      sources   = ["video/out/x11_common.c",
                   "video/out/vo_x11.c"])

check("-vulkan*",
      desc      = "Vulkan context support (libplacebo)",
      deps      = "libplacebo",
      fn        = lambda: check_pkg_config("vulkan"),
      sources   = ["video/out/vulkan/context.c",
                   "video/out/vulkan/utils.c"])
check(deps      = ["vulkan", "x11"],
      sources   = "video/out/vulkan/context_xlib.c")
check(deps      = ["vulkan", "wayland"],
      sources   = "video/out/vulkan/context_wayland.c")
check("-hwdec-vulkan*",
      desc      = "Vulkan hardware acceleration (libplacebo)",
      deps      = ["libplacebo", "vulkan"],
      sources   = "video/out/hwdec/hwdec_vulkan.c")

check("-egl*",
      desc      = "EGL",
      fn        = lambda: check_pkg_config("egl") or
                          (check_cc(link = "-lEGL") and
                           check_cc(link = "-lGLESv2")))
check("libgl*",
      desc      = "libGL",
      fn        = lambda: check_cc(link = "-lGL"))
check("-gl-x11-backend*",
      desc      = "OpenGL X11 Backend (GLX)",
      deps      = ["libgl", "x11"],
      fn        = lambda: check_cc(include = "GL/glx.h",
                                   expr = "glXGetCurrentDisplay();"))
check("-egl-x11-backend*",
      desc      = "OpenGL X11 EGL Backend",
      deps      = ["libgl", "x11", "egl", "gbm"])
check("-egl-drm-backend*",
      desc      = "OpenGL DRM EGL Backend",
      deps      = ["libgl", "drm", "gbm", "egl"])
check("-gl-wayland-backend*",
      desc      = "OpenGL Wayland Backend",
      deps      =  ["libgl", "wayland", "egl"],
      fn        = lambda: check_pkg_config("wayland-egl >= 9.0.0"))
check("-gl*",
      desc      = "OpenGL context support",
      deps      = "libgl",
      deps_any  = ["gl-x11-backend", "egl-x11-backend", "egl-drm-backend", "gl-wayland-backend"],
      sources   = ["video/out/opengl/common.c",
                   "video/out/opengl/context.c",
                   "video/out/opengl/formats.c",
                   "video/out/opengl/ra_gl.c",
                   "video/out/opengl/utils.c"])
check("-gl-x11*",
      desc      = "OpenGL X11",
      deps      = ["gl", "gl-x11-backend"],
      sources   = "video/out/opengl/context_glx.c")
check("-egl-x11*",
      desc      = "OpenGL X11 EGL",
      deps      = ["gl", "egl-x11-backend"],
      sources   = "video/out/opengl/context_x11egl.c")
check("-egl-drm*",
      desc      = "OpenGL DRM EGL",
      deps      = ["gl", "egl-drm-backend"],
      sources   = "video/out/opengl/context_drm_egl.c")
check("-gl-wayland*",
      desc      = "OpenGL Wayland",
      deps      = ["gl", "gl-wayland-backend"],
      sources   = "video/out/opengl/context_wayland.c")
check("egl-helpers*",
      desc      = "EGL helper functions",
      deps_any  = ["egl-x11", "egl-drm", "gl-wayland"],
      sources   = "video/out/opengl/egl_helpers.c"),

check("-vdpau*",
      desc      = "VDPAU",
      deps      = ["gpl", "x11"],
      fn        = lambda: check_pkg_config("vdpau >= 0.2"),
      sources   = ["video/filter/vf_vdpaupp.c",
                   "video/vdpau.c",
                   "video/vdpau_mixer.c",
                   "video/out/vo_vdpau.c"])
check("-vdpau-gl-x11*",
      desc      = "VDPAU with OpenGL/X11",
      deps      = ["vdpau", "gl-x11"],
      sources   = "video/out/opengl/hwdec_vdpau.c")

check("-vaapi*",
      desc      = "VA-API acceleration",
      fn        = lambda: check_pkg_config("libva >= 0.36.0"),
      sources   = ["video/vaapi.c",
                   "video/filter/vf_vavpp.c"])
check("-vaapi-x11*",
      desc      = "VA-API (X11 support)",
      deps      = ["vaapi", "x11"],
      fn        = lambda: check_pkg_config("libva-x11 >= 0.36.0"))
check("-vaapi-wayland*",
      desc      = "VA-API (Wayland support)",
      deps      = ["vaapi", "gl-wayland"],
      fn        = lambda: check_pkg_config("libva-wayland >= 0.36.0"),
      sources   = "video/out/vo_dmabuf_wayland.c")
check("-vaapi-drm*",
      desc      = "VA-API (DRM/EGL support)",
      deps      = ["vaapi", "egl-drm"],
      fn        = lambda: check_pkg_config("libva-drm >= 0.36.0"))
check("-vaapi-glx*",
      desc      = "VA-API GLX",
      deps      = ["gpl", "vaapi-x11", "gl-x11"])
check("-vaapi-x-egl*",
      desc      = "VA-API EGL on X11",
      deps      = ["vaapi-x11", "egl-x11"])
check("-vaapi-vulkan*",
      desc      = "VA-API Vulkan",
      deps      = ["vaapi", "vulkan"],
      sources   = ["video/out/hwdec/hwdec_vaapi.c"])
check("-vaapi-egl*",
      desc      = "VA-API EGL",
      deps_any  = ["vaapi-x-egl", "vaapi-wayland"],
      sources   = ["video/out/hwdec/hwdec_vaapi.c"])
check(deps      = ["drm", "egl", "gl"],
      sources   = "video/out/hwdec/dmabuf_interop_gl.c")
check(deps      = ["egl", "libplacebo", "vaapi"],
      sources   = "video/out/hwdec/dmabuf_interop_pl.c")
check(deps      = ["drm", "egl", "gl"],
      sources   = "video/out/hwdec/dmabuf_interop_gl.c")
check(deps      = ["drm", "egl", "libplacebo", "vaapi"],
      sources   = "video/out/hwdec/dmabuf_interop_pl.c")

check("-jpeg*",
      desc      = "JPEG support",
      fn        = lambda: chain (check_pkg_config("libjxl.pc"),
                                 check_cc(include = ["stdio.h", "jpeglib.h"],
                                          link = "-ljpeg")))

check(deps      = ["drm", "egl", "gbm", "gl"],
      sources   = "video/out/hwdec/dmabuf_interop_gl.c")

check(deps_any   = ["drm", "x11", "wayland"],
      sources    = "video/out/present_sync.c")

check(deps      = ["vulkan", "wayland"],
      sources   = "video/out/vulkan/context_wayland.c")
check(deps      = ["vulkan", "x11"],
      sources   = "video/out/vulkan/context_xlib.c")

check(deps      = ["gl", "egl", "egl-helpers"],
      sources   = "video/filter/vf_gpu.c")

add_sources(
    "audio/aframe.c",
    "audio/chmap.c",
    "audio/chmap_avchannel.c",
    "audio/chmap_sel.c",
    "audio/decode/ad_lavc.c",
    "audio/decode/ad_spdif.c",
    "audio/filter/af_drop.c",
    "audio/filter/af_format.c",
    "audio/filter/af_lavcac3enc.c",
    "audio/filter/af_scaletempo.c",
    "audio/fmt-conversion.c",
    "audio/format.c",
    "audio/out/ao.c",
    "audio/out/ao_lavc.c",
    "audio/out/ao_null.c",
    "audio/out/ao_pcm.c",
    "audio/out/buffer.c",
    "common/av_common.c",
    "common/av_log.c",
    "common/codecs.c",
    "common/common.c",
    "common/encode_lavc.c",
    "common/msg.c",
    "common/playlist.c",
    "common/recorder.c",
    "common/stats.c",
    "common/tags.c",
    "common/version.c",
    "demux/cache.c",
    "demux/codec_tags.c",
    "demux/cue.c",
    "demux/demux.c",
    "demux/demux_cue.c",
    "demux/demux_edl.c",
    "demux/demux_lavf.c",
    "demux/demux_mf.c",
    "demux/demux_mkv.c",
    "demux/demux_mkv_timeline.c",
    "demux/demux_null.c",
    "demux/demux_playlist.c",
    "demux/demux_raw.c",
    "demux/demux_timeline.c",
    "demux/ebml.c",
    "demux/packet.c",
    "demux/packet_pool.c",
    "demux/timeline.c",
    "filters/filter.c",
    "filters/f_async_queue.c",
    "filters/f_auto_filters.c",
    "filters/f_autoconvert.c",
    "filters/f_decoder_wrapper.c",
    "filters/f_demux_in.c",
    "filters/f_hwtransfer.c",
    "filters/f_lavfi.c",
    "filters/f_output_chain.c",
    "filters/f_swresample.c",
    "filters/f_swscale.c",
    "filters/f_utils.c",
    "filters/frame.c",
    "filters/user_filters.c",
    "input/cmd.c",
    "input/event.c",
    "input/input.c",
    "input/ipc.c",
    "input/ipc-unix.c",
    "input/keycodes.c",
    "misc/bstr.c",
    "misc/charset_conv.c",
    "misc/dispatch.c",
    "misc/json.c",
    "misc/language.c",
    "misc/natural_sort.c",
    "misc/node.c",
    "misc/random.c",
    "misc/rendezvous.c",
    "misc/ta.c",
    "misc/ta_talloc.c",
    "misc/ta_utils.c",
    "misc/thread_pool.c",
    "misc/thread_tools.c",
    "options/m_config_core.c",
    "options/m_config_frontend.c",
    "options/m_option.c",
    "options/m_property.c",
    "options/options.c",
    "options/parse_commandline.c",
    "options/parse_configfile.c",
    "options/path.c",
    "osdep/io.c",
    "osdep/subprocess.c",
    "osdep/subprocess-posix.c",
    "osdep/terminal-unix.c",
    "osdep/threads.c",
    "osdep/timer.c",
    "osdep/timer-unix.c",
    "player/audio.c",
    "player/client.c",
    "player/command.c",
    "player/configfiles.c",
    "player/external_files.c",
    "player/loadfile.c",
    "player/main.c",
    "player/misc.c",
    "player/osd.c",
    "player/playloop.c",
    "player/screenshot.c",
    "player/scripting.c",
    "player/sub.c",
    "player/video.c",
    "stream/cookies.c",
    "stream/stream.c",
    "stream/stream_avdevice.c",
    "stream/stream_cb.c",
    "stream/stream_concat.c",
    "stream/stream_edl.c",
    "stream/stream_file.c",
    "stream/stream_lavf.c",
    "stream/stream_memory.c",
    "stream/stream_mf.c",
    "stream/stream_null.c",
    "stream/stream_slice.c",
    "sub/dec_sub.c",
    "sub/draw_bmp.c",
    "sub/filter_sdh.c",
    "sub/img_convert.c",
    "sub/lavc_conv.c",
    "sub/osd.c",
    "sub/sd_lavc.c",
    "video/csputils.c",
    "video/filter/refqueue.c",
    "video/filter/vf_format.c",
    "video/filter/vf_sub.c",
    "video/fmt-conversion.c",
    "video/hwdec.c",
    "video/image_loader.c",
    "video/image_writer.c",
    "video/img_format.c",
    "video/mp_image.c",
    "video/mp_image_pool.c",
    "video/vd_lavc.c",
    "video/out/aspect.c",
    "video/out/bitmap_packer.c",
    "video/out/dither.c",
    "video/out/dr_helper.c",
    "video/out/filter_kernels.c",
    "video/out/gpu/context.c",
    "video/out/gpu/error_diffusion.c",
    "video/out/gpu/hwdec.c",
    "video/out/gpu/lcms.c",
    "video/out/gpu/osd.c",
    "video/out/gpu/ra.c",
    "video/out/gpu/shader_cache.c",
    "video/out/gpu/user_shaders.c",
    "video/out/gpu/utils.c",
    "video/out/gpu/video.c",
    "video/out/gpu/video_shaders.c",
    "video/out/vo.c",
    "video/out/vo_gpu.c",
    "video/out/vo_image.c",
    "video/out/vo_lavc.c",
    "video/out/vo_null.c",
    "video/out/win_state.c",
    "video/repack.c",
    "video/sws_utils.c",
)

finish()
